load("@rules_cc//cc:defs.bzl", "cc_binary")

package(default_visibility = ["//visibility:public"])

cc_binary(
    # üî• ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå smart_capture_wasm.js)
    name = "smart_capture_wasm",
    
    srcs = [],
    
    linkopts = [
        "-sALLOW_MEMORY_GROWTH=1",
        "-sINITIAL_MEMORY=32MB",
        "-sUSE_PTHREADS=0",
        "--bind",
        "-sTOTAL_STACK=16MB",
    ],
    
    # üì¶ ‡∏ù‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå Graph ‡πÅ‡∏•‡∏∞ Model ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    data = [
        "smart_capture.pbtxt",    # ‚úÖ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏°‡∏µ _wasm)
        "//mediapipe/modules/face_landmark:face_landmark_with_attention.tflite",
    ],
    
    deps = [
        "//mediapipe/calculators/smart_capture:smart_capture_calculator",
        "//mediapipe/graphs/face_mesh:desktop_live_calculators",
        "//mediapipe/framework:calculator_framework",
        "//mediapipe/framework/formats:image_frame",
        "//mediapipe/framework/port:status",
        "//mediapipe/modules/face_landmark:face_landmark_front_cpu",
    ],
)